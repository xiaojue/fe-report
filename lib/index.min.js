/*!
 * @version 0.1.0
 * @date 2018-01-10
 */
!function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["fe-report"]=t():e["fe-report"]=t()}("undefined"!==typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(1),a=n(2),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i={dataKey:"",mergeReport:!0,delay:1e3,url:"",getPath:"",postPath:"",random:1};return n.config=a.a.assignObject(i,e),n.queue={get:[],post:[]},n.getUrl=n.config.url+n.config.getPath,n.postUrl=n.config.url+n.config.postPath,n}return i(t,e),s(t,[{key:"reportByGet",value:function(e){this.sendData("get",e)}},{key:"reportByPost",value:function(e){this.sendData("post",e)}},{key:"sendData",value:function(e,t){this.catchData(e,t)&&this.delayReport()}},{key:"delayReport",value:function(e){var t=this;if(this.trigger("beforeReport")){var n=this.config.mergeReport?this.config.delay:0;setTimeout(function(){t.trigger("beforeSend")&&t.report(e)},n)}}},{key:"catchData",value:function(e,t){return!(Math.random()>=this.config.random)&&(this.queue[e].push(t),this.queue[e])}},{key:"report",value:function(e){var t=this;Promise.all([this.getRequest(),this.postRequest()]).then(function(n){t.trigger("afterReport"),e&&e.call(t,n)})}},{key:"getRequest",value:function(){var e=this;return new Promise(function(t){if(0===e.queue.get.length)t();else{var n=e._getParames("get"),r=e.getUrl+"?"+e.config.dataKey+"="+n,o=new window.Image;o.onload=function(){t(n)},o.src=r}})}},{key:"postRequest",value:function(){var e=this;return new Promise(function(t){if(0===e.queue.post.length)t();else{var n=e._getParames("post"),r=new XMLHttpRequest;r.onreadystatechange=function(){4==r.readyState&&200==r.status&&t(n)},r.open("POST",e.postUrl,!0),r.setRequestHeader("Content-Type","application/json");var o={};o[e.config.dataKey]=n,r.send(JSON.stringify(o))}})}},{key:"_getParames",value:function(e){var t=this.queue[e],n=this.config.mergeReport,r=n?t:[t.shift()];return n&&(this.queue[e]=[]),r.map(function(e){return a.a.serializeObj(e)}).join("|")}}]),t}(u.a);t.default=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e),this.handlers={}}return o(e,[{key:"on",value:function(e,t){return this.handlers[e]=this.handlers[e]||[],this.handlers[e].push(t),this.handlers[e]}},{key:"off",value:function(e){this.handlers[e]&&delete this.handlers[e]}},{key:"trigger",value:function(e,t){var n=this,r=t||[],o=this.handlers[e];return!o||o.every(function(e){return!1!==e.apply(n,r)})}}]),e}();t.a=i},function(e,t,n){"use strict";var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o={typeDecide:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},serializeObj:function(e){var t="";return Object.keys(e).forEach(function(n){o.typeDecide(e[n],"Object")?t+=n+"="+o.stringify(e[n]):t+=n+"="+e[n]+"^"}),encodeURIComponent(t.substr(0,t.length-1))},stringify:function(e){if(window.JSON&&window.JSON.stringify)return JSON.stringify(e);var t="undefined"===typeof e?"undefined":r(e);if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,o,i=[],u=e&&e.constructor==Array,a=arguments.callee;for(n in e)e.hasOwnProperty(n)&&(o=e[n],t="undefined"===typeof o?"undefined":r(o),e.hasOwnProperty(n)&&("string"==t?o='"'+o+'"':"object"==t&&null!==o&&(o=a(o)),i.push((u?"":'"'+n+'":')+String(o))));return(u?"[":"{")+String(i)+(u?"]":"}")},assignObject:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}};t.a=o}])});